<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script type="module">
    import DataStore from './src/dataStore.js';

    var ds = new DataStore({
        obj: {
            a: 3
        },
        a: 1,
        b: 2,
    });

    console.log(ds);

    window.ds = ds;

    ds.watch('a', (...args) => console.log('a', ...args));
    ds.watch('obj', (...args) => console.log('obj', ...args));
    ds.watch('obj.a', (...args) => console.log('obj.a', ...args));
    ds.watch('obj.b', (...args) => console.log('obj.b', ...args));
    ds.watch('obj.c', (...args) => console.log('obj.c', ...args));

    // 这个地方只触发了一次 obj 的 watch 是正常的
    // 因为事件是有汇总的
    // b 怎么又没有触发
    ds.obj.a = 1;
    ds.obj.b = 3;           // 这次不触发任何事件是正常的, 因为之前没有任何处理, 这个地方有个问题, 就是一开始没有声明, 但中间赋值的数值, 会发生完全不触发事件的问题
    ds.obj.c = 7;
    ds.setIn('obj.c', 3);
    ds.setIn('obj.b', 2);
    ds.setIn('obj.b', 4);
    ds.obj.b = 5;
    ds.obj.b = 1;
    // 一个属性存在两个 watcher 的情况 & 动态插入 watcher 的情况
    ds.watch('obj', (...args) => console.log('obj', ...args));
    ds.watch('obj.c', (...args) => console.log('obj.c 2', ...args));
    ds.setIn('obj.c', 4);


    ds.c = 1;
    ds.watch('c', (...args) => console.log('c', ...args));
    ds.c = 2;   // 初始化的时候没有定义的变量是不会监听成功的
    ds.setIn('c', 10);

</script>
</body>
</html>